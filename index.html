<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Vireon - Discord Bot Hosting</title>
    <style>
        /* (Previous CSS remains exactly the same) */
    </style>
</head>
<body>
    <!-- (Previous HTML remains the same until the script section) -->

    <script>
        // DOM Elements
        const loginBtn = document.getElementById('loginBtn');
        const signupBtn = document.getElementById('signupBtn');
        const authModal = document.getElementById('authModal');
        const authForm = document.getElementById('authForm');
        const authSubmit = document.getElementById('authSubmit');
        const authSwitch = document.getElementById('authSwitch');
        const dashboard = document.getElementById('dashboard');
        const botsList = document.getElementById('botsList');
        const connectBotBtn = document.getElementById('connectBotBtn');
        const botConnectPanel = document.getElementById('botConnectPanel');
        const commandEditor = document.getElementById('commandEditor');
        const commandsList = document.getElementById('commandsList');
        const commandSettings = document.getElementById('commandSettings');
        const botTokenInput = document.getElementById('botToken');
        const submitBotToken = document.getElementById('submitBotToken');

        // API Configuration
        const API_BASE = window.location.origin;
        let currentUser = null;
        let currentBot = null;

        // Initialize
        checkAuth();

        // Auth Functions
        function toggleAuthModal(login = false) {
            isLoginMode = login;
            authModal.classList.toggle('hidden');
            document.getElementById('modalTitle').textContent = login ? 'Log In' : 'Sign Up';
            authSubmit.textContent = login ? 'Log In' : 'Sign Up';
            authSwitch.innerHTML = login ? 
                'Need an account? <a href="#">Sign Up</a>' : 
                'Already have an account? <a href="#">Log In</a>';
        }

        async function handleAuth(e) {
            e.preventDefault();
            const email = document.getElementById('authEmail').value;
            const password = document.getElementById('authPassword').value;
            
            try {
                const endpoint = isLoginMode ? '/api/login' : '/api/register';
                const response = await fetch(`${API_BASE}${endpoint}`, {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({ email, password })
                });

                if (!response.ok) {
                    const error = await response.json();
                    throw new Error(error.error || 'Authentication failed');
                }

                const { token, user } = await response.json();
                localStorage.setItem('vireon_token', token);
                currentUser = user;
                authModal.classList.add('hidden');
                dashboard.classList.remove('hidden');
                loadBots();
            } catch (error) {
                alert(error.message);
            }
        }

        // Bot Management Functions
        async function loadBots() {
            try {
                const response = await fetch(`${API_BASE}/api/bots`, {
                    headers: { 
                        'Authorization': `Bearer ${localStorage.getItem('vireon_token')}`
                    }
                });

                if (!response.ok) throw new Error('Failed to load bots');
                
                botsList.innerHTML = '';
                const bots = await response.json();
                
                bots.forEach(bot => {
                    const botElement = document.createElement('div');
                    botElement.className = 'bot-item';
                    botElement.innerHTML = `
                        <h4>${bot.name}</h4>
                        <p>Status: <span class="bot-status ${bot.status}">${bot.status}</span></p>
                        <button onclick="manageBot('${bot.id}')">Manage</button>
                    `;
                    botsList.appendChild(botElement);
                });
            } catch (error) {
                console.error('Error loading bots:', error);
                alert('Failed to load bots');
            }
        }

        async function connectBot() {
            const token = botTokenInput.value.trim();
            if (!token) return alert('Please enter a bot token');

            try {
                const response = await fetch(`${API_BASE}/api/bots`, {
                    method: 'POST',
                    headers: { 
                        'Content-Type': 'application/json',
                        'Authorization': `Bearer ${localStorage.getItem('vireon_token')}`
                    },
                    body: JSON.stringify({ token })
                });

                if (!response.ok) {
                    const error = await response.json();
                    throw new Error(error.error || 'Failed to connect bot');
                }

                const bot = await response.json();
                botTokenInput.value = '';
                botConnectPanel.classList.add('hidden');
                loadBots();
                alert(`Bot ${bot.name} connected successfully!`);
            } catch (error) {
                console.error('Error connecting bot:', error);
                alert(error.message);
            }
        }

        async function manageBot(botId) {
            currentBot = botId;
            commandEditor.classList.remove('hidden');
            loadCommands(botId);
        }

        async function loadCommands(botId) {
            try {
                // In a real implementation, you would fetch commands from your API
                // For this example, we'll use a predefined list
                commandsList.innerHTML = `
                    <div class="command-option" onclick="showCommandSettings('welcome')">
                        <h4>Welcome Message</h4>
                        <p>Send message when user joins</p>
                    </div>
                    <div class="command-option" onclick="showCommandSettings('moderation')">
                        <h4>Moderation</h4>
                        <p>Kick/ban users</p>
                    </div>
                    <div class="command-option" onclick="showCommandSettings('custom')">
                        <h4>Custom Command</h4>
                        <p>Create your own command</p>
                    </div>
                `;
            } catch (error) {
                console.error('Error loading commands:', error);
            }
        }

        function showCommandSettings(commandType) {
            let settingsHTML = '';
            
            switch(commandType) {
                case 'welcome':
                    settingsHTML = `
                        <h3>Welcome Message Settings</h3>
                        <textarea id="welcomeMessage" placeholder="Enter welcome message (use {user} for mention)"></textarea>
                        <button onclick="saveCommand('welcome', '!welcome', document.getElementById('welcomeMessage').value)">
                            Save Welcome Message
                        </button>
                    `;
                    break;
                    
                case 'moderation':
                    settingsHTML = `
                        <h3>Moderation Settings</h3>
                        <select id="moderationAction">
                            <option value="kick">Kick</option>
                            <option value="ban">Ban</option>
                            <option value="warn">Warn</option>
                        </select>
                        <input type="text" id="moderationCommand" placeholder="Command trigger (e.g., !kick)">
                        <button onclick="saveCommand('moderation', document.getElementById('moderationCommand').value, 
                            document.getElementById('moderationAction').value)">
                            Save Moderation Command
                        </button>
                    `;
                    break;
                    
                case 'custom':
                    settingsHTML = `
                        <h3>Custom Command</h3>
                        <input type="text" id="customCommandName" placeholder="Command name (e.g., !hello)">
                        <textarea id="customCommandResponse" placeholder="Command response"></textarea>
                        <button onclick="saveCommand('custom', 
                            document.getElementById('customCommandName').value,
                            document.getElementById('customCommandResponse').value)">
                            Save Custom Command
                        </button>
                    `;
                    break;
            }
            
            commandSettings.innerHTML = settingsHTML;
        }

        async function saveCommand(type, name, response) {
            if (!name || !response) return alert('Please fill all fields');
            
            try {
                const response = await fetch(`${API_BASE}/api/commands`, {
                    method: 'POST',
                    headers: { 
                        'Content-Type': 'application/json',
                        'Authorization': `Bearer ${localStorage.getItem('vireon_token')}`
                    },
                    body: JSON.stringify({
                        botId: currentBot,
                        commandName: name,
                        commandResponse: response
                    })
                });

                if (!response.ok) {
                    const error = await response.json();
                    throw new Error(error.error || 'Failed to save command');
                }

                alert('Command saved successfully!');
            } catch (error) {
                console.error('Error saving command:', error);
                alert(error.message);
            }
        }

        // Event Listeners
        loginBtn.addEventListener('click', () => toggleAuthModal(true));
        signupBtn.addEventListener('click', () => toggleAuthModal(false));
        authForm.addEventListener('submit', handleAuth);
        authSwitch.addEventListener('click', (e) => {
            e.preventDefault();
            toggleAuthModal(!isLoginMode);
        });
        connectBotBtn.addEventListener('click', () => {
            botConnectPanel.classList.remove('hidden');
            commandEditor.classList.add('hidden');
        });
        submitBotToken.addEventListener('click', connectBot);

        // Check authentication state
        async function checkAuth() {
            const token = localStorage.getItem('vireon_token');
            if (!token) return;
            
            try {
                // Verify token and get user data
                // In a real app, you would call your API's /me endpoint
                currentUser = { email: 'authenticated@user.com' };
                dashboard.classList.remove('hidden');
                loadBots();
            } catch (error) {
                localStorage.removeItem('vireon_token');
            }
        }

        // Expose functions to global scope for button clicks
        window.manageBot = manageBot;
        window.showCommandSettings = showCommandSettings;
        window.saveCommand = saveCommand;
    </script>
</body>
</html>
